summary: A portable Foreign Function Interface library
web-url: https://sourceware.org/libffi
git-url: https://github.com/libffi/libffi
src-url: https://github.com/libffi/libffi/releases/download/v3.4.4/libffi-3.4.4.tar.gz
src-sha: d66c56ad259a82cf2a9dfc408b32bf5da52371500b84745f7fb8b645712df676
license: MIT
dep-upp: patch
dopatch: |
    # https://github.com/libffi/libffi/pull/764
    patch -p1 <<EOF
    diff --git a/include/ffi_common.h b/include/ffi_common.h
    index 2bd31b03d..c53a79493 100644
    --- a/include/ffi_common.h
    +++ b/include/ffi_common.h
    @@ -128,6 +128,10 @@ void *ffi_data_to_code_pointer (void *data) FFI_HIDDEN;
        static trampoline. */
     int ffi_tramp_is_present (void *closure) FFI_HIDDEN;
     
    +/* Return a file descriptor of a temporary zero-sized file in a
    +   writable and executable filesystem. */
    +int open_temp_exec_file(void) FFI_HIDDEN;
    +
     /* Extended cif, used in callback from assembly routine */
     typedef struct
     {
    diff --git a/src/tramp.c b/src/tramp.c
    index b9d273a1a..c3f4c9933 100644
    --- a/src/tramp.c
    +++ b/src/tramp.c
    @@ -39,6 +39,10 @@
     #ifdef __linux__
     #define _GNU_SOURCE 1
     #endif
    +
    +#include <ffi.h>
    +#include <ffi_common.h>
    +
     #include <stdio.h>
     #include <unistd.h>
     #include <stdlib.h>
    EOF
install: |
    unset CFLAGS
    unset CPPFLAGS
    unset LDFLAGS
    configure \
        --with-sysroot="$SYSROOT" \
        --disable-symvers \
        --disable-docs
