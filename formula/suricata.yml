summary: Network IDS, IPS, and security monitoring engine
web-url: https://suricata-ids.org
git-url: https://github.com/OISF/suricata
src-url: https://www.openinfosecfoundation.org/download/suricata-7.0.4.tar.gz
src-sha: 640060120024be70dbe81f6ec6efc72e46250fcb36219dff67e6417220ff21b7
license: GPL-2.0-or-later
dep-pkg: libjansson liblz4 libmagic libpcre2 libiconv libyaml libpcap libnet libglob
dep-upp: libtool
bsystem: autotools cargo

prepare: |
    export CARGO_BUILD_TARGET="$RUST_TARGET"

    sed_in_place "s|RUST_TARGET = .*|RUST_TARGET = --target $RUST_TARGET|" rust/Makefile.am
    sed_in_place "s|RUST_SURICATA_LIB_XC_DIR=.*|RUST_SURICATA_LIB_XC_DIR=$RUST_TARGET/|" configure.ac

    run rustup target add "$RUST_TARGET"

install: |
    configure \
        --enable-pie \
        --with-libpcap-includes="$libpcap_INCLUDE_DIR" \
        --with-libpcap-libraries="$libpcap_LIBRARY_DIR" \
        ac_cv_lib_pthread_pthread_create=yes \
        ac_cv_lib_jansson_json_dump_callback=yes \
        ac_cv_lib_pcap_pcap_open_dead=yes

# void endgrent(void) __INTRODUCED_IN(26);
api-min: 26
